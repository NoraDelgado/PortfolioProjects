--COVID_Portfolio_Project
-- Queries

-- Shows likelihood of diying if you contract covid in your country
Select location, date, total_cases, total_deaths,(total_deaths/total_cases)*100 as death_percentage
From `indigo-coder-379702.Portfolio_Project_1.Covid_Deaths`
Where location like 'United States'
order by 1,2

-- Shows what percentage of population got Covid per day in US
Select location, date, population, total_cases, (total_cases/population)*100 as percent_population_infected
From `indigo-coder-379702.Portfolio_Project_1.Covid_Deaths`
Where location like 'United States'
order by 1,2

-- Shows what percentage of population died from covid per day in US
Select location, date, population, total_cases, (total_cases/population)*100 as death_percentage
From `indigo-coder-379702.Portfolio_Project_1.Covid_Deaths`
Where location like 'United States'
order by 1,2

--Showing Countries with Highest Death Count per Population
Select location, MAX(cast(total_deaths as int)) as total_death_count
FROM indigo-coder-379702.Portfolio_Project_1.Covid_Deaths
Where continent is not null
Group by location
order by total_death_count desc

--Showing Countries with Highest Death Count per Population by Continent
Select location, MAX(cast(total_deaths as int)) as total_death_count
FROM indigo-coder-379702.Portfolio_Project_1.Covid_Deaths
Where continent is null
Group by location
order by total_death_count desc 

-- Looking at Countries with Highest Infection Rate compared to Population
Select location, population, MAX(total_cases) as highest_infection_count, MAX((total_cases/population))*100 as percent_population_infected
From `indigo-coder-379702.Portfolio_Project_1.Covid_Deaths`
Where continent is not null
Group by location, population
order by percent_population_infected desc

-- Showing continents with highest death count per population
Select continent, MAX(cast(total_deaths as int)) as total_death_count
FROM indigo-coder-379702.Portfolio_Project_1.Covid_Deaths
Where continent is not null
Group by continent
order by total_death_count desc 

--Global Numbers per day 
SELECT date,
       SUM(new_cases) AS total_cases,
       SUM(CAST(new_deaths AS INT)) AS total_deaths,
       CASE WHEN SUM(new_cases) = 0 THEN 0
            ELSE (SUM(CAST(new_deaths AS INT)) / NULLIF(SUM(new_cases), 0)) * 100
       END AS death_percentage
FROM `indigo-coder-379702.Portfolio_Project_1.Covid_Deaths`
WHERE continent IS NOT NULL
GROUP BY date
ORDER BY 1, 2

-- Global numbers across the world
SELECT
       SUM(new_cases) AS total_cases,
       SUM(CAST(new_deaths AS INT)) AS total_deaths,
       CASE WHEN SUM(new_cases) = 0 THEN 0
            ELSE (SUM(CAST(new_deaths AS INT)) / NULLIF(SUM(new_cases), 0)) * 100
       END AS death_percentage
FROM `indigo-coder-379702.Portfolio_Project_1.Covid_Deaths`
WHERE continent IS NOT NULL
ORDER BY 1, 2

-- Looking at Total Population vs Vaccinations
SELECT dea.continent, dea.location, dea.date, dea.population, vac.new_vaccinations, 
  SUM(cast(vac.new_vaccinations as int)) OVER (Partition by dea.location ORDER BY dea.location, dea.date) as rolling_people_vaccinated
FROM `indigo-coder-379702.Portfolio_Project_1.Covid_Deaths` as dea
JOIN `indigo-coder-379702.Portfolio_Project_1.Covid_Vaccinations` as vac
  On dea.location = vac.location
  and dea.date = vac.date
WHERE dea.continent is not null
ORDER BY 2,3

-- Show percentaje of population vaccinated
CREATE TEMP TABLE percent_population_vaccinated
AS (
  SELECT dea.continent,
         dea.location,
         dea.date,
         dea.population,
         vac.new_vaccinations,
         SUM(CAST(vac.new_vaccinations AS INT)) OVER (PARTITION BY dea.location ORDER BY dea.location, dea.date) AS rolling_people_vaccinated
  FROM `indigo-coder-379702.Portfolio_Project_1.Covid_Deaths` AS dea
  JOIN `indigo-coder-379702.Portfolio_Project_1.Covid_Vaccinations` AS vac
    ON dea.location = vac.location
    AND dea.date = vac.date
  WHERE dea.continent IS NOT NULL
);

SELECT continent,
       location,
       date,
       population,
       new_vaccinations,
       rolling_people_vaccinated,
       CASE WHEN population = 0 THEN 0 ELSE (rolling_people_vaccinated / population) * 100 END AS vaccination_percentage
FROM percent_population_vaccinated;